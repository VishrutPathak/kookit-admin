import{d as F,a as O,r as l,l as b,c as T,j as e,s as q}from"./index-DyF85uUZ.js";import{i as L}from"./ingredients-CVToZE81.js";import{r as P}from"./recipes-D2cB7iwa.js";import{r as p,b as J}from"./imageResolver-ClQL_M5f.js";function V(){return b("kookit_ingredients",null)?.ingredients??L.ingredients}function H(){const{id:c}=F(),h=O(),d=V(),o=l.useRef(null),[x,v]=l.useState([]);l.useEffect(()=>{const s=b("kookit_recipes",null);v(s?.recipes??P.recipes)},[]);const r=c?x.find(s=>s.id===c):null,[t,i]=l.useState(()=>r?{...r}:{id:T("r"),title:"",cuisine:"",veg:!0,tags:[],ingredients:[],steps:[],image:"",createdAt:new Date().toISOString()}),[m,j]=l.useState("");l.useEffect(()=>{r&&i({...r})},[r]);function N(s){q("kookit_recipes",{recipes:s}),h("/recipes")}const f=()=>{const s=x.filter(a=>a.id!==t.id);s.unshift({...t,updatedAt:new Date().toISOString()}),N(s)},y=()=>{i({...t,ingredients:[...t.ingredients||[],{ingredientId:d[0]?.id??"",qty:1,unit:d[0]?.unit??""}]})},u=(s,a)=>{const n=[...t.ingredients||[]];n[s]={...n[s],...a},i({...t,ingredients:n})},C=s=>{i({...t,ingredients:(t.ingredients||[]).filter((a,n)=>n!==s)})},k=()=>i({...t,steps:[...t.steps||[],""]}),I=(s,a)=>i({...t,steps:(t.steps||[]).map((n,g)=>g===s?a:n)}),R=s=>i({...t,steps:(t.steps||[]).filter((a,n)=>n!==s)}),S=()=>o.current&&o.current.click(),w=s=>{const a=s.target.files?.[0];if(!a)return;const n=new FileReader;n.onload=g=>{const E=g.target.result;i(_=>({..._,image:E})),s.target.value=""},n.readAsDataURL(a)},U=()=>{m&&(i(s=>({...s,image:m})),j(""))},A=()=>i(s=>({...s,image:""})),D=s=>s?.image?s.image:p&&p[s.id]?p[s.id]:J;return e.jsxs("div",{className:"container-fluid",children:[e.jsx("input",{type:"file",accept:"image/*",ref:o,onChange:w,style:{display:"none"}}),e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h3",{children:c?"Edit Recipe":"New Recipe"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-secondary me-2",onClick:()=>h(-1),children:"Cancel"}),e.jsx("button",{className:"btn btn-primary",onClick:f,children:"Save"})]})]}),e.jsx("div",{className:"card shadow-sm",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small",children:"Title"}),e.jsx("input",{className:"form-control",value:t.title,onChange:s=>i({...t,title:s.target.value})})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label small",children:"Cuisine"}),e.jsx("input",{className:"form-control",value:t.cuisine,onChange:s=>i({...t,cuisine:s.target.value})})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label small",children:"Veg"}),e.jsxs("select",{className:"form-select",value:t.veg?"true":"false",onChange:s=>i({...t,veg:s.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"Veg"}),e.jsx("option",{value:"false",children:"Non-veg"})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label small",children:"Tags (comma separated)"}),e.jsx("input",{className:"form-control",value:(t.tags||[]).join(", "),onChange:s=>i({...t,tags:s.target.value.split(",").map(a=>a.trim()).filter(Boolean)})})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label small d-block mb-2",children:"Recipe Image"}),e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:D(t),alt:t.title,className:"rounded w-100",style:{height:160,objectFit:"cover",border:"1px solid #eee"}})}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:S,children:"Upload image"}),e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Paste image URL",value:m,onChange:s=>j(s.target.value)}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:U,children:"Apply"})]}),e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:A,children:"Remove image"})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Ingredients"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:y,children:"Add ingredient"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>i({...t,ingredients:[]}),children:"Clear"})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingredient"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[(t.ingredients||[]).map((s,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("select",{className:"form-select",value:s.ingredientId,onChange:n=>u(a,{ingredientId:n.target.value}),children:d.map(n=>e.jsx("option",{value:n.id,children:n.name},n.id))})}),e.jsx("td",{children:e.jsx("input",{className:"form-control",value:s.qty,onChange:n=>u(a,{qty:n.target.value})})}),e.jsx("td",{children:e.jsx("input",{className:"form-control",value:s.unit,onChange:n=>u(a,{unit:n.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>C(a),children:"Remove"})})]},a)),(t.ingredients||[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center text-muted",children:"No ingredients"})})]})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Steps"}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:k,children:"Add step"})]}),e.jsxs("div",{children:[(t.steps||[]).map((s,a)=>e.jsxs("div",{className:"mb-2 input-group",children:[e.jsx("span",{className:"input-group-text",children:a+1}),e.jsx("input",{className:"form-control",value:s,onChange:n=>I(a,n.target.value)}),e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>R(a),children:"Remove"})]},a)),(t.steps||[]).length===0&&e.jsx("div",{className:"text-muted",children:"No steps yet."})]})]})]})})})]})}export{H as default};
