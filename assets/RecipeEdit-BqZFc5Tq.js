import{d as J,a as M,r as l,l as R,c as I,j as e,s as Q}from"./index-Cb7WF7WO.js";import{i as W}from"./ingredients-CVToZE81.js";import{r as Y}from"./recipes-D2cB7iwa.js";import{r as b,b as z}from"./imageResolver-B71T8x4S.js";function G(){return R("kookit_ingredients",null)?.ingredients??W.ingredients}function ee(){const{id:v}=J(),m=M(),d=G(),u=l.useRef(null),[o,N]=l.useState([]);l.useEffect(()=>{const s=R("kookit_recipes",null);N(s?.recipes??Y.recipes)},[]);const r=o.find(s=>s.id===v),[t,a]=l.useState(()=>({id:I("r"),title:"",cuisine:"",veg:!0,tags:[],ingredients:[],steps:[],image:"",createdAt:new Date().toISOString()})),[h,c]=l.useState(null),[f,y]=l.useState(!1),[g,k]=l.useState("");l.useEffect(()=>{r&&a({...r})},[r]);function p(s,n=!0){Q("kookit_recipes",{recipes:s}),N(s),n&&m("/recipes")}const S=()=>!t.title||t.title.trim().length<2?"Title is required (min 2 chars).":(t.ingredients||[]).length===0?"Add at least one ingredient.":(t.steps||[]).length===0?"Add at least one step.":null,C=()=>{const s=S();if(s){c({type:"danger",text:s});return}const n=o.filter(i=>i.id!==t.id);n.unshift({...t,updatedAt:new Date().toISOString()}),p(n)},U=()=>{if(!confirm("Delete this recipe permanently?"))return;const s=o.filter(n=>n.id!==t.id);p(s)},A=()=>{const s={...t,id:I("r"),title:`${t.title} (Copy)`,createdAt:new Date().toISOString()},n=[s,...o];p(n,!1),c({type:"success",text:"Recipe duplicated. You can edit the new copy."}),setTimeout(()=>m(`/recipes/${s.id}`),600)},D=()=>{const s=d[0]?.id??"";a({...t,ingredients:[...t.ingredients||[],{ingredientId:s,qty:1,unit:d.find(n=>n.id===s)?.unit||""}]})},x=(s,n)=>{const i=[...t.ingredients||[]];i[s]={...i[s],...n},a({...t,ingredients:i})},E=s=>a({...t,ingredients:t.ingredients.filter((n,i)=>i!==s)}),T=()=>a({...t,steps:[...t.steps||[],""]}),q=(s,n)=>a({...t,steps:t.steps.map((i,j)=>j===s?n:i)}),F=s=>a({...t,steps:t.steps.filter((n,i)=>i!==s)}),L=s=>{const n=d.find(i=>i.id===s);return n?n.name:`Unknown (${s})`},w=s=>s?.image?s.image:b&&b[s.id]?b[s.id]:z,O=()=>{u.current&&u.current.click()},P=s=>{const n=s.target.files?.[0];if(!n)return;const i=new FileReader;i.onload=j=>{const $=j.target.result;a(B=>({...B,image:$})),s.target.value=""},i.readAsDataURL(n)},_=()=>{if(!g)return c({type:"danger",text:"Enter an image URL first."});a(s=>({...s,image:g})),k(""),c({type:"success",text:"Image URL applied to recipe."})},V=()=>{a(s=>({...s,image:""}))};return r?e.jsxs("div",{className:"container-fluid",children:[e.jsx("input",{type:"file",accept:"image/*",ref:u,onChange:P,style:{display:"none"}}),e.jsxs("div",{className:"d-flex justify-content-between align-items-start mb-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-1",children:"Edit Recipe"}),e.jsx("small",{className:"text-muted",children:t.title||"Untitled"})]}),e.jsxs("div",{className:"btn-group",children:[e.jsx("button",{className:"btn btn-outline-secondary",onClick:()=>m(-1),children:"Back"}),e.jsx("button",{className:"btn btn-outline-primary",onClick:()=>{y(s=>!s)},children:f?"Edit mode":"Preview"}),e.jsx("button",{className:"btn btn-outline-success",onClick:A,children:"Duplicate"}),e.jsx("button",{className:"btn btn-danger",onClick:U,children:"Delete"})]})]}),h&&e.jsx("div",{className:`alert alert-${h.type||"info"}`,children:h.text}),f?e.jsx("div",{className:"card shadow-sm mb-3",children:e.jsx("div",{className:"card-body",children:e.jsxs("div",{className:"row",children:[e.jsxs("div",{className:"col-md-8",children:[e.jsx("h4",{children:t.title}),e.jsxs("p",{className:"text-muted small mb-1",children:[t.cuisine," • ",t.veg?"Veg":"Non-veg"]}),e.jsx("p",{className:"mb-3",children:t.tags&&t.tags.map(s=>e.jsx("span",{className:"badge bg-light text-dark me-1",children:s},s))}),e.jsx("h6",{children:"Ingredients"}),e.jsx("ul",{children:(t.ingredients||[]).map((s,n)=>e.jsxs("li",{children:[s.qty," ",s.unit," — ",L(s.ingredientId)]},n))}),e.jsx("h6",{children:"Steps"}),e.jsx("ol",{children:(t.steps||[]).map((s,n)=>e.jsx("li",{children:s},n))})]}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:w(t),alt:t.title,className:"rounded w-100",style:{height:220,objectFit:"cover",border:"1px solid #eee"}})}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-outline-primary me-2",onClick:()=>y(!1),children:"Back to edit"}),e.jsx("button",{className:"btn btn-success",onClick:C,children:"Save from preview"})]})]})]})})}):e.jsx(e.Fragment,{children:e.jsx("div",{className:"card shadow-sm mb-3",children:e.jsxs("div",{className:"card-body",children:[e.jsxs("div",{className:"row g-3",children:[e.jsx("div",{className:"col-md-8",children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-6",children:[e.jsx("label",{className:"form-label small",children:"Title"}),e.jsx("input",{className:"form-control",value:t.title,onChange:s=>a({...t,title:s.target.value})})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label small",children:"Cuisine"}),e.jsx("input",{className:"form-control",value:t.cuisine,onChange:s=>a({...t,cuisine:s.target.value})})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("label",{className:"form-label small",children:"Veg / Non-Veg"}),e.jsxs("select",{className:"form-select",value:t.veg?"true":"false",onChange:s=>a({...t,veg:s.target.value==="true"}),children:[e.jsx("option",{value:"true",children:"Veg"}),e.jsx("option",{value:"false",children:"Non-veg"})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsx("label",{className:"form-label small",children:"Tags (comma separated)"}),e.jsx("input",{className:"form-control",value:(t.tags||[]).join(", "),onChange:s=>a({...t,tags:s.target.value.split(",").map(n=>n.trim()).filter(Boolean)})})]})]})}),e.jsxs("div",{className:"col-md-4",children:[e.jsx("label",{className:"form-label small d-block mb-2",children:"Recipe Image"}),e.jsx("div",{className:"mb-3",children:e.jsx("img",{src:w(t),alt:t.title,className:"rounded w-100",style:{height:160,objectFit:"cover",border:"1px solid #eee"}})}),e.jsxs("div",{className:"d-grid gap-2",children:[e.jsx("button",{type:"button",className:"btn btn-outline-primary btn-sm",onClick:O,children:"Upload image"}),e.jsxs("div",{className:"input-group input-group-sm",children:[e.jsx("input",{type:"text",className:"form-control",placeholder:"Paste image URL",value:g,onChange:s=>k(s.target.value)}),e.jsx("button",{className:"btn btn-outline-secondary",type:"button",onClick:_,children:"Apply"})]}),e.jsx("button",{className:"btn btn-outline-danger btn-sm",onClick:V,children:"Remove image"})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Ingredients"}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-sm btn-outline-primary me-2",onClick:D,children:"Add ingredient"}),e.jsx("button",{className:"btn btn-sm btn-outline-secondary",onClick:()=>a({...t,ingredients:[]}),children:"Clear"})]})]}),e.jsxs("table",{className:"table",children:[e.jsx("thead",{className:"table-light",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Ingredient"}),e.jsx("th",{children:"Qty"}),e.jsx("th",{children:"Unit"}),e.jsx("th",{})]})}),e.jsxs("tbody",{children:[(t.ingredients||[]).map((s,n)=>e.jsxs("tr",{children:[e.jsx("td",{style:{minWidth:200},children:e.jsx("select",{className:"form-select",value:s.ingredientId,onChange:i=>x(n,{ingredientId:i.target.value}),children:d.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))})}),e.jsx("td",{style:{width:140},children:e.jsx("input",{className:"form-control",value:s.qty,onChange:i=>x(n,{qty:i.target.value})})}),e.jsx("td",{style:{width:140},children:e.jsx("input",{className:"form-control",value:s.unit,onChange:i=>x(n,{unit:i.target.value})})}),e.jsx("td",{className:"text-end",children:e.jsx("button",{className:"btn btn-sm btn-danger",onClick:()=>E(n),children:"Remove"})})]},n)),(t.ingredients||[]).length===0&&e.jsx("tr",{children:e.jsx("td",{colSpan:"4",className:"text-center text-muted",children:"No ingredients"})})]})]})]}),e.jsxs("div",{className:"col-12",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("h6",{className:"mb-0",children:"Steps"}),e.jsx("button",{className:"btn btn-sm btn-outline-primary",onClick:T,children:"Add step"})]}),e.jsxs("div",{children:[(t.steps||[]).map((s,n)=>e.jsxs("div",{className:"mb-2 input-group",children:[e.jsx("span",{className:"input-group-text",style:{width:42},children:n+1}),e.jsx("input",{className:"form-control",value:s,onChange:i=>q(n,i.target.value)}),e.jsx("button",{className:"btn btn-outline-danger",onClick:()=>F(n),children:"Remove"})]},n)),(t.steps||[]).length===0&&e.jsx("div",{className:"text-muted",children:"No steps yet."})]})]})]}),e.jsxs("div",{className:"mt-3 d-flex justify-content-end",children:[e.jsx("button",{className:"btn btn-secondary me-2",onClick:()=>{a({...r}),c({type:"info",text:"Reverted to last saved."})},children:"Revert"}),e.jsx("button",{className:"btn btn-primary",onClick:C,children:"Save changes"})]})]})})})]}):e.jsx("div",{className:"container-fluid",children:e.jsx("div",{className:"alert alert-warning",children:"Recipe not found."})})}export{ee as default};
